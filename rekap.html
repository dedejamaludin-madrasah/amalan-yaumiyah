<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rekap Amalan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 pb-20">

    <div class="bg-green-600 p-4 text-white shadow">
        <h1 class="font-bold text-lg">Riwayat Amalan</h1>
    </div>

    <div class="p-4" id="content">
        <p id="loading" class="text-center text-gray-500 mt-10">Mengambil data...</p>
        <div id="list" class="space-y-3"></div>
    </div>

    <div class="fixed bottom-0 w-full bg-white border-t flex justify-around py-3 text-gray-500 text-xs shadow-inner">
        <a href="dashboard.html" class="flex flex-col items-center hover:text-green-600">
            <i class="fa-solid fa-house mb-1 text-lg"></i> Input
        </a>
        <a href="rekap.html" class="flex flex-col items-center text-green-600">
            <i class="fa-solid fa-list mb-1 text-lg"></i> Rekap
        </a>
    </div>

    <script src="config.js"></script>
    <script>
        checkSession().then(async (user) => {
            const { data, error } = await db
                .from('daily_amalan')
                .select('*')
                .eq('user_id', user.id)
                .order('date', { ascending: false })
                .limit(20);

            const listEl = document.getElementById('list');
            document.getElementById('loading').remove();

            if(!data || data.length === 0) {
                listEl.innerHTML = '<p class="text-center">Belum ada data.</p>';
                return;
            }

            data.forEach(item => {
                const dateFmt = new Date(item.date).toLocaleDateString('id-ID', { weekday:'short', day:'numeric', month:'short'});
                
                const html = `
                <div class="bg-white p-3 rounded shadow border border-l-4 border-l-green-500">
                    <div class="flex justify-between font-bold text-gray-700 mb-2 border-b pb-1">
                        <span>${dateFmt}</span>
                    </div>
                    <div class="grid grid-cols-2 text-sm gap-y-1">
                        <div>ðŸ•Œ Jamaah: <b>${item.shalat_jamaah || 0}</b></div>
                        <div>ðŸ“– Tilawah: <b>${item.tilawah_juz || 0}</b></div>
                        <div class="col-span-2 mt-1 flex gap-2">
                            ${item.infaq ? '<span class="bg-green-100 text-green-800 text-xs px-2 py-0.5 rounded">Infaq</span>' : ''}
                            ${item.olahraga ? '<span class="bg-orange-100 text-orange-800 text-xs px-2 py-0.5 rounded">Olahraga</span>' : ''}
                        </div>
                    </div>
                </div>`;
                listEl.innerHTML += html;
            });
        });
    </script>
</body>
</html>